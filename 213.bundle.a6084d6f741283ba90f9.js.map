{"version":3,"file":"213.bundle.a6084d6f741283ba90f9.js","mappings":"iJAEMA,E,mDAAKC,GACLC,EAAoB,GAAGF,sC,qCCE7B,MAAMG,EAAiB,CACrBC,gCAAiC,mCACjCC,iCAAkC,mCAClCC,+BAAgC,mCAEhCC,gCAAiC,4BACjCC,sDAAuD,+BAGnDC,EAAeC,OAAOC,OAAOR,GAC7BS,EAA+B,CACnCT,EAAeI,gCACfJ,EAAeK,uDAaXK,EAA8BH,OAAOC,OAVT,CAChCG,2BAA4B,0BAC5BC,yCAA0C,0BAC1CC,wCAAyC,0BACzCC,wCAAyC,0BACzCC,kCAAmC,0BACnCC,sBAAuB,0BACvBC,yBAA0B,4B,wNCvB5B,MAAMC,EAAYC,EAAAA,KAAW,IACpB,iCAGHC,EAA+BC,GAEjCF,EAAAA,cAACA,EAAAA,SAAc,CAACG,SAAUH,EAAAA,cAAA,WAAK,eAC7BA,EAAAA,cAACD,EAAcG,IAgDrB,QAxC4B,CAI1BxB,GAAE,EAQF0B,kBAAiBA,EAAC,gBAAEC,EAAe,iBAAEC,KAW5B,CAAC,CAAEC,KAAM,cAAeC,UAVcN,GAEzCF,EAAAA,cAACC,EAA4BQ,EAAA,CAC3BJ,gBAAiBA,EACjBC,iBAAkBA,GACdJ,MAOZQ,yBDuDa,SAAkCC,GAC/C,MAAM,gBAAEN,EAAe,iBAAEC,GAAqBK,EAK9C,MAAO,CACL,CACEJ,KAAM,cACNpB,eACAyB,yBAR6BC,GArEDC,EAACD,EAAWR,EAAiBC,KAC7D,MAAMS,EAAaT,EAAiBU,sBAAsB,GAG1D,OADAC,QAAQC,KAAK,cAAeH,GACrBF,EACJM,OAAOC,IACN,MAAMC,EACJD,EAASE,4BAA8BF,EAASG,mBAAqBH,EAAS,YAEhF,QAAI7B,EAA4BiC,SAASH,IAIrCD,EAASK,cAAgB5C,EAAeE,kCAO1CO,EAA6BkC,SAASJ,EAASK,cAAgBL,EAASM,gBAAkB,KAG7FC,IAAIC,IACH,MAAM,SAAEC,EAAQ,eAAEC,EAAc,kBAAEC,EAAoB,QAAO,QAAEC,GAAYJ,GACrE,aAAEK,EAAY,WAAEC,EAAU,kBAAEC,EAAiB,iBAAEC,EAAgB,eAAEV,EAAc,IAAEW,GACrFT,EACIU,EAAWvB,EAAWwB,SAASC,UAAU,CAC7CZ,WACAa,WAAY,QACZC,IAAK,YACLL,QAEIM,EAAa,CAEjBd,WACAe,sBAAuBC,EAAAA,GAAMC,OAC7Bf,oBACAE,eACAC,aACAJ,iBACAK,oBACAC,mBACAxD,kBAAiB,EACjBmE,iBAAkB,KAClBC,aAAc,KACdC,aAAcC,EAAAA,MAAAA,aAAqBC,MACnCtC,UAAW,CAACe,GACZwB,gBAAiBrC,EAAWwB,SAASc,qBAAqBzB,GAC1D0B,aA/Ce,KAgDfC,SAAU,CAACvB,GACXwB,qBAAqB,EACrBC,UAAU,EACVtE,eACAuE,eAAgBhC,EAChBE,WACA+B,qBAAqB,EACrBC,MAAO7B,GAAqB,GAAG8B,EAAAA,EAAKC,EAAE,aAAa7B,OAAkB4B,EAAAA,EAAKC,EAAEjC,MAM9E,OAJAkC,EAAAA,UAAAA,wBAAgCC,IAAIhC,EAAS,CAC3CiC,KAAM,iBACN7C,SAAU,CAAE8C,SAAU5B,KAEjBK,KAOF7B,CAA0BD,EAAWR,EAAiBC,IAUjE,E","sources":["webpack:///../../../extensions/dicom-video/src/id.js","webpack:///../../../extensions/dicom-video/src/getSopClassHandlerModule.js","webpack:///../../../extensions/dicom-video/src/index.tsx"],"sourcesContent":["import packageJson from '../package.json';\n\nconst id = packageJson.name;\nconst SOPClassHandlerId = `${id}.sopClassHandlerModule.dicom-video`;\n\nexport { SOPClassHandlerId, id };\n","import { SOPClassHandlerId } from './id';\nimport { utils } from '@ohif/core';\nimport i18n from '@ohif/i18n';\nimport { utilities as csUtils, Enums as csEnums } from '@cornerstonejs/core';\n\nconst SOP_CLASS_UIDS = {\n  VIDEO_MICROSCOPIC_IMAGE_STORAGE: '1.2.840.10008.5.1.4.1.1.77.1.2.1',\n  VIDEO_PHOTOGRAPHIC_IMAGE_STORAGE: '1.2.840.10008.5.1.4.1.1.77.1.4.1',\n  VIDEO_ENDOSCOPIC_IMAGE_STORAGE: '1.2.840.10008.5.1.4.1.1.77.1.1.1',\n  /** Need to use fallback, could be video or image */\n  SECONDARY_CAPTURE_IMAGE_STORAGE: '1.2.840.10008.5.1.4.1.1.7',\n  MULTIFRAME_TRUE_COLOR_SECONDARY_CAPTURE_IMAGE_STORAGE: '1.2.840.10008.5.1.4.1.1.7.4',\n};\n\nconst sopClassUids = Object.values(SOP_CLASS_UIDS);\nconst secondaryCaptureSopClassUids = [\n  SOP_CLASS_UIDS.SECONDARY_CAPTURE_IMAGE_STORAGE,\n  SOP_CLASS_UIDS.MULTIFRAME_TRUE_COLOR_SECONDARY_CAPTURE_IMAGE_STORAGE,\n];\n\nconst SupportedTransferSyntaxes = {\n  MPEG4_AVC_264_HIGH_PROFILE: '1.2.840.10008.1.2.4.102',\n  MPEG4_AVC_264_BD_COMPATIBLE_HIGH_PROFILE: '1.2.840.10008.1.2.4.103',\n  MPEG4_AVC_264_HIGH_PROFILE_FOR_2D_VIDEO: '1.2.840.10008.1.2.4.104',\n  MPEG4_AVC_264_HIGH_PROFILE_FOR_3D_VIDEO: '1.2.840.10008.1.2.4.105',\n  MPEG4_AVC_264_STEREO_HIGH_PROFILE: '1.2.840.10008.1.2.4.106',\n  HEVC_265_MAIN_PROFILE: '1.2.840.10008.1.2.4.107',\n  HEVC_265_MAIN_10_PROFILE: '1.2.840.10008.1.2.4.108',\n};\n\nconst supportedTransferSyntaxUIDs = Object.values(SupportedTransferSyntaxes);\n\nconst _getDisplaySetsFromSeries = (instances, servicesManager, extensionManager) => {\n  const dataSource = extensionManager.getActiveDataSource()[0];\n  const thumbnailSrc = null;\n  console.warn('dataSource=', dataSource);\n  return instances\n    .filter(metadata => {\n      const tsuid =\n        metadata.AvailableTransferSyntaxUID || metadata.TransferSyntaxUID || metadata['00083002'];\n\n      if (supportedTransferSyntaxUIDs.includes(tsuid)) {\n        return true;\n      }\n\n      if (metadata.SOPClassUID === SOP_CLASS_UIDS.VIDEO_PHOTOGRAPHIC_IMAGE_STORAGE) {\n        return true;\n      }\n\n      // Assume that an instance with one of the secondary capture SOPClassUIDs and\n      // with at least 90 frames (i.e. typically 3 seconds of video) is indeed a video.\n      return (\n        secondaryCaptureSopClassUids.includes(metadata.SOPClassUID) && metadata.NumberOfFrames >= 90\n      );\n    })\n    .map(instance => {\n      const { Modality, SOPInstanceUID, SeriesDescription = 'VIDEO', imageId } = instance;\n      const { SeriesNumber, SeriesDate, SeriesInstanceUID, StudyInstanceUID, NumberOfFrames, url } =\n        instance;\n      const videoUrl = dataSource.retrieve.directURL({\n        instance,\n        singlepart: 'video',\n        tag: 'PixelData',\n        url,\n      });\n      const displaySet = {\n        //plugin: id,\n        Modality,\n        displaySetInstanceUID: utils.guid(),\n        SeriesDescription,\n        SeriesNumber,\n        SeriesDate,\n        SOPInstanceUID,\n        SeriesInstanceUID,\n        StudyInstanceUID,\n        SOPClassHandlerId,\n        referencedImages: null,\n        measurements: null,\n        viewportType: csEnums.ViewportType.VIDEO,\n        instances: [instance],\n        getThumbnailSrc: dataSource.retrieve.getGetThumbnailSrc?.(instance),\n        thumbnailSrc,\n        imageIds: [imageId],\n        isDerivedDisplaySet: true,\n        isLoaded: false,\n        sopClassUids,\n        numImageFrames: NumberOfFrames,\n        instance,\n        supportsWindowLevel: true,\n        label: SeriesDescription || `${i18n.t('Series')} ${SeriesNumber} - ${i18n.t(Modality)}`,\n      };\n      csUtils.genericMetadataProvider.add(imageId, {\n        type: 'imageUrlModule',\n        metadata: { rendered: videoUrl },\n      });\n      return displaySet;\n    });\n};\n\nexport default function getSopClassHandlerModule(params) {\n  const { servicesManager, extensionManager } = params;\n  const getDisplaySetsFromSeries = instances => {\n    return _getDisplaySetsFromSeries(instances, servicesManager, extensionManager);\n  };\n\n  return [\n    {\n      name: 'dicom-video',\n      sopClassUids,\n      getDisplaySetsFromSeries,\n    },\n  ];\n}\n","import React from 'react';\nimport getSopClassHandlerModule from './getSopClassHandlerModule';\nimport { id } from './id';\n\nconst Component = React.lazy(() => {\n  return import(/* webpackPrefetch: true */ './viewports/OHIFCornerstoneVideoViewport');\n});\n\nconst OHIFCornerstoneVideoViewport = props => {\n  return (\n    <React.Suspense fallback={<div>Loading...</div>}>\n      <Component {...props} />\n    </React.Suspense>\n  );\n};\n\n/**\n *\n */\nconst dicomVideoExtension = {\n  /**\n   * Only required property. Should be a unique value across all extensions.\n   */\n  id,\n\n  /**\n   *\n   *\n   * @param {object} [configuration={}]\n   * @param {object|array} [configuration.csToolsConfig] - Passed directly to `initCornerstoneTools`\n   */\n  getViewportModule({ servicesManager, extensionManager }) {\n    const ExtendedOHIFCornerstoneVideoViewport = props => {\n      return (\n        <OHIFCornerstoneVideoViewport\n          servicesManager={servicesManager}\n          extensionManager={extensionManager}\n          {...props}\n        />\n      );\n    };\n\n    return [{ name: 'dicom-video', component: ExtendedOHIFCornerstoneVideoViewport }];\n  },\n  getSopClassHandlerModule,\n};\n\nfunction _getToolAlias(toolName) {\n  let toolAlias = toolName;\n\n  switch (toolName) {\n    case 'EllipticalRoi':\n      toolAlias = 'SREllipticalRoi';\n      break;\n  }\n\n  return toolAlias;\n}\n\nexport default dicomVideoExtension;\n"],"names":["id","packageJson","SOPClassHandlerId","SOP_CLASS_UIDS","VIDEO_MICROSCOPIC_IMAGE_STORAGE","VIDEO_PHOTOGRAPHIC_IMAGE_STORAGE","VIDEO_ENDOSCOPIC_IMAGE_STORAGE","SECONDARY_CAPTURE_IMAGE_STORAGE","MULTIFRAME_TRUE_COLOR_SECONDARY_CAPTURE_IMAGE_STORAGE","sopClassUids","Object","values","secondaryCaptureSopClassUids","supportedTransferSyntaxUIDs","MPEG4_AVC_264_HIGH_PROFILE","MPEG4_AVC_264_BD_COMPATIBLE_HIGH_PROFILE","MPEG4_AVC_264_HIGH_PROFILE_FOR_2D_VIDEO","MPEG4_AVC_264_HIGH_PROFILE_FOR_3D_VIDEO","MPEG4_AVC_264_STEREO_HIGH_PROFILE","HEVC_265_MAIN_PROFILE","HEVC_265_MAIN_10_PROFILE","Component","React","OHIFCornerstoneVideoViewport","props","fallback","getViewportModule","servicesManager","extensionManager","name","component","_extends","getSopClassHandlerModule","params","getDisplaySetsFromSeries","instances","_getDisplaySetsFromSeries","dataSource","getActiveDataSource","console","warn","filter","metadata","tsuid","AvailableTransferSyntaxUID","TransferSyntaxUID","includes","SOPClassUID","NumberOfFrames","map","instance","Modality","SOPInstanceUID","SeriesDescription","imageId","SeriesNumber","SeriesDate","SeriesInstanceUID","StudyInstanceUID","url","videoUrl","retrieve","directURL","singlepart","tag","displaySet","displaySetInstanceUID","utils","guid","referencedImages","measurements","viewportType","csEnums","VIDEO","getThumbnailSrc","getGetThumbnailSrc","thumbnailSrc","imageIds","isDerivedDisplaySet","isLoaded","numImageFrames","supportsWindowLevel","label","i18n","t","csUtils","add","type","rendered"],"sourceRoot":""}